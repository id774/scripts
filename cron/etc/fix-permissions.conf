########################################################################
# fix-permissions.conf
#
#  This file is sourced by the calling script to adjust ownership and
#  permissions on common system paths and cron directories.
#
#  Rules:
#  - Blank lines are ignored.
#  - Lines starting with '#' are treated as comments (leading spaces allowed).
#  - This file must be POSIX sh compatible.
#  - Do not add a shebang; this file is sourced, not executed.
#
#  Variables:
#  - ADMIN_MAIL_ADDRESS: Optional administrative email address.
#    Example (disabled by default):
#    #ADMIN_MAIL_ADDRESS="root"
#
#  Functions:
#  - fix_permissions: Perform ownership and mode adjustments on specific
#    system directories.
#
#  Logging:
#  - Expects JOBLOG to be defined by the caller. All actions append to JOBLOG.
#
########################################################################

# Define admin mail address
#ADMIN_MAIL_ADDRESS="root"

# Define fix_permissions as a configurable operation
fix_permissions() {
    echo "[INFO] Setting permission for /opt/python, /opt/ruby" >> "$JOBLOG" 2>&1
    chown -R root:root /opt/python
    chown -R root:root /opt/ruby

    echo "[INFO] Setting permission for /usr/local/etc, /usr/local/src" >> "$JOBLOG" 2>&1
    chown -R root:root /usr/local/etc
    chown -R root:root /usr/local/src

    echo "[INFO] Setting permission for /var/log/chkrootkit" >> "$JOBLOG" 2>&1
    chown -R root:adm /var/log/chkrootkit
    chmod 750 /var/log/chkrootkit

    echo "[INFO] Setting permission for /etc/cron.*" >> "$JOBLOG" 2>&1
    for dir in /etc/cron.hourly /etc/cron.daily /etc/cron.weekly /etc/cron.monthly /etc/cron.exec; do
        find "$dir" -type f -exec chmod u=rwx,g=r,o= {} \; -exec chown :adm {} \; 2>> "$JOBLOG"
    done
    for dir in /etc/cron.d /etc/cron.config; do
        find "$dir" -type f -exec chmod u=rw,g=r,o= {} \; -exec chown :adm {} \; 2>> "$JOBLOG"
    done
}
